"use strict";var preColIndex,preSortType,userRowElements=document.querySelectorAll("#mnuser-table tbody tr"),tableRowElements=document.querySelectorAll("#mnuser-table tr"),tableBodyElement=document.querySelector("#mnuser-table tbody"),displayCheckboxElements=document.querySelectorAll("#mnuser-display .mmnuser-display-item input"),sortingIconsElements=document.querySelectorAll(".mnuser-cell-sort"),COL=Object.freeze({ROLE:0,NAME:1,EMAIL:2,PHONE_NUM:3,DOB:4,GENDER:5,ADDRESS:6,CITY:7,AREA:8,STAR:9,EXPENSE:10,ID:11}),parser=new DOMParser;function removeUserFromDatabase(e){var n=e.children[COL.ID].innerHTML;try{fetch("/api/users/".concat(n),{method:"DELETE"}).then(function(n){n.json().then(function(n){n.message?Swal.fire({icon:"error",title:"Oops...",html:n.message}):(e.remove(),Swal.fire({icon:"success",title:"Thành công",html:"Xóa tài khoản thành công"}),refreshTable())})})}catch(e){return!1}}function removeAUser(e){Swal.fire({title:"Cảnh báo",icon:"warning",html:"Bạn có chắc chắn xóa tài khoản <b>".concat(e.children[COL.EMAIL].innerHTML,"</b> không?"),confirmButtonColor:"#E74C3C",confirmButtonText:"Chắc chắn",showCancelButton:!0,cancelButtonColor:"#99A3A4",cancelButtonText:"Không"}).then(function(n){n.isConfirmed&&removeUserFromDatabase(e)})}function showTableColumn(e){tableRowElements.forEach(function(n){n.children[e].style.display="table-cell"})}function hideTableColumn(e){tableRowElements.forEach(function(n){n.children[e].style.display="none"})}function formatExpenseValues(){userRowElements.forEach(function(e){e.children[COL.EXPENSE].innerHTML=parseInt(e.children[COL.EXPENSE].innerHTML,10).toLocaleString("it-IT",{style:"currency",currency:"VND"})})}function refreshTable(){userRowElements=document.querySelectorAll("#mnuser-table tbody tr"),tableRowElements=document.querySelectorAll("#mnuser-table tr"),eventRowUsers()}function refreshDisplay(){formatExpenseValues(),displayCheckboxElements.forEach(function(e,n){!1===e.checked&&hideTableColumn(n)})}function sortAllUsers(e,n){fetch("/admin/manageUser/sort/".concat(e,"/").concat(n)).then(function(e){e.text().then(function(e){var n=parser.parseFromString(e,"text/html");console.log(n),tableBodyElement.innerHTML=n.getElementById("mnuser-users").innerHTML,refreshTable(),refreshDisplay()})})}function initTable(){preColIndex=COL.ROLE,preSortType=0,sortingIconsElements[preColIndex].children[preSortType].classList.add("mnuser-cell-sort-asc-selected"),sortAllUsers(preColIndex,preSortType)}function eventDisplayCheckboxes(){displayCheckboxElements.forEach(function(e,n){e.addEventListener("click",function(){!0===e.checked?showTableColumn(n):hideTableColumn(n)})})}function eventSorting(){var e=["asc","desc"],n=0;sortingIconsElements.forEach(function(t,r){for(var o=function(o){t.children[o].addEventListener("click",function(){t.children[o].classList.add("mnuser-cell-sort-".concat(e[o],"-selected")),sortingIconsElements[preColIndex].children[preSortType].classList.remove("mnuser-cell-sort-".concat(e[preSortType],"-selected")),preColIndex===r&&preSortType===o?(n+=1)%2==0?(t.children[o].classList.add("mnuser-cell-sort-".concat(e[o],"-selected")),sortAllUsers(r,o)):sortAllUsers(-1,0):(n=0,sortAllUsers(r,o)),preColIndex=r,preSortType=o}),t.children[o].addEventListener("mouseenter",function(){t.children[o].classList.add("mnuser-cell-sort-".concat(e[o],"-hover"))}),t.children[o].addEventListener("mouseleave",function(){t.children[o].classList.remove("mnuser-cell-sort-".concat(e[o],"-hover"))})},l=0;l<t.children.length;++l)o(l)})}function eventRowUsers(){userRowElements.forEach(function(e){e.addEventListener("click",function(){"user"===e.children[COL.ROLE].innerHTML?Swal.fire({icon:"info",title:"Cảnh báo",html:"Mọi thay đổi của bạn không thể khôi phục lại!",confirmButtonText:"Lịch sử giao dịch",showDenyButton:!0,denyButtonText:"Xóa",showCancelButton:!0,cancelButtonText:"Trở lại"}).then(function(n){n.isConfirmed?window.open("/admin/manageUser/transaction-history/".concat(e.children[COL.ID].innerHTML)):n.isDenied&&removeAUser(e)}):Swal.fire({icon:"warning",title:"Cảnh báo",html:"Loại tài khoản này không thể truy cập!",confirmedButtonText:"Trở lại"})})})}function handleEvents(){eventDisplayCheckboxes(),eventSorting()}function main(){initTable(),refreshTable(),refreshDisplay(),handleEvents()}main();