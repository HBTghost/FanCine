"use strict";var modal=document.getElementById("modal"),parser=new DOMParser,redirectURL="",forceLogin=!1;function popdownModal(){fetch("/isLogin").then(function(e){e.text().then(function(e){forceLogin&&"true"===e?window.location.reload():forceLogin&&(window.location="/")})}),modal.style.display="none"}function popupModal(){modal.style.display="block"}function popupLogin(){popupModal(),$('#modal a[href="#nav-sign-in"]').tab("show")}function popupRegister(){popupModal(),$('#modal a[href="#nav-sign-up"]').tab("show")}function popupForgot(){document.querySelector("#nav-forgot-tab").style.display="block",popupModal(),$('#modal a[href="#nav-forgot"]').tab("show")}function renderUsernameToggle(){fetch("/render/header").then(function(e){e.text().then(function(e){var o=parser.parseFromString(e,"text/html");document.querySelector("#usernameToggle").innerHTML=o.querySelector("#usernameToggle").innerHTML})})}function login(e){e.preventDefault(),fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:document.querySelector("#emailLogin").value,password:document.querySelector("#passwordLogin").value})}).then(function(e){e.json().then(function(e){e.message?alert(e.message):(redirectURL.length>0&&(window.location=redirectURL,redirectURL=""),renderUsernameToggle(),popdownModal())})})}function showVerify(){document.querySelector("#nav-verify-tab").style.display="block",$('#modal a[href="#nav-verify"]').tab("show")}function register(e){e.preventDefault(),fetch("/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:document.querySelector("#name").value,email:document.querySelector("#regEmail").value,password:document.querySelector("#regPassword").value,password2:document.querySelector("#regPassword2").value,phone:document.querySelector("#regPhone").value,DoB:document.querySelector("#regBirthday").value,sex:document.querySelector("#regGender").value,address:document.querySelector("#regAddress").value,city:document.querySelector("#regCity").value,town:document.querySelector("#regTown").value})}).then(function(e){e.json().then(function(e){e.success_msg?(alert(e.success_msg),showVerify()):alert(e.msg)})})}function logout(e){e.preventDefault(),fetch("/logout").then(function(){renderUsernameToggle(),fetch("#").then(function(e){e.text().then(function(e){"notAuth"===e&&(popupModal(),forceLogin=!0)})})})}function showForgot(e){e.preventDefault(),document.querySelector("#nav-forgot-tab").style.display="block",$('#modal a[href="#nav-forgot"]').tab("show")}function showReset(){document.querySelector("#nav-reset-tab").style.display="block",$('#modal a[href="#nav-reset"]').tab("show")}function hideUnused(){document.querySelector("#nav-verify-tab").style.display="none",document.querySelector("#nav-forgot-tab").style.display="none",document.querySelector("#nav-reset-tab").style.display="none"}function forgot(e){e.preventDefault(),fetch("/forgot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:document.querySelector("#forgotEmail").value})}).then(function(e){e.json().then(function(e){e.success_msg?(alert(e.success_msg),showReset()):alert(e.msg)})})}function resetPasswordForm(e){e.preventDefault();var o=document.querySelector("#resetToken").value;fetch("/forgot/".concat(o)).then(function(e){e.json().then(function(e){e.msg?alert(e.msg):fetch("/reset/".concat(e.id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:document.querySelector("#resetPassword").value,password2:document.querySelector("#resetPassword2").value})}).then(function(e){e.json().then(function(e){e.success_msg?(alert(e.success_msg),$('#modal a[href="#nav-sign-in"]').tab("show"),hideUnused()):alert(e.msg)})})})})}function verify(e){e.preventDefault();var o=document.querySelector("#verifyToken").value;fetch("/activate/".concat(o)).then(function(e){e.json().then(function(e){e.msg?alert(e.msg):(alert(e.success_msg),$('#modal a[href="#nav-sign-in"]').tab("show"),hideUnused())})})}function forceLoginAndRedirect(e){redirectURL=e,fetch("/isLogin").then(function(o){o.text().then(function(o){"false"===o?popupModal():window.location=e})})}window.onclick=function(e){e.target===modal&&popdownModal()};