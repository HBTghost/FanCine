"use strict";var loginW=null,registerW=null,activateW=null,forgotW=null,resetW=null,modal=document.getElementById("modal"),parser=new DOMParser,redirectURL="",forceLogin=!1,spinnerModal=document.getElementsByClassName("spinner-modal")[0];function enableSpinner(){spinnerModal.style.display="block"}function disableSpinner(){spinnerModal.style.display="none"}function popdownModal(){enableSpinner(),fetch("/isLogin").then(function(e){e.text().then(function(e){forceLogin&&"true"===e?window.location.reload():forceLogin&&(window.location="/")})}),modal.style.display="none",disableSpinner()}function popupModal(){modal.style.display="block"}function popupLogin(){popupModal(),$('#modal a[href="#nav-sign-in"]').tab("show")}function popupRegister(){popupModal(),$('#modal a[href="#nav-sign-up"]').tab("show")}function popupForgot(){document.querySelector("#nav-forgot-tab").style.display="block",popupModal(),$('#modal a[href="#nav-forgot"]').tab("show")}function renderUsernameToggle(){fetch("/render/header").then(function(e){e.text().then(function(e){var t=parser.parseFromString(e,"text/html");document.querySelector("#usernameToggle").innerHTML=t.querySelector("#usernameToggle").innerHTML})})}function login(e){enableSpinner(),e.preventDefault(),$("#loginBtn").attr("disabled","disabled"),fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:document.querySelector("#emailLogin").value,password:document.querySelector("#passwordLogin").value,"g-recaptcha-response":grecaptcha.getResponse(loginW)})}).then(function(e){e.json().then(function(e){e.message?Swal.fire({icon:"error",title:"Oops...",html:e.message}):(redirectURL.length>0&&(window.location=redirectURL,redirectURL=""),renderUsernameToggle(),popdownModal())})}).finally(function(){grecaptcha.reset(loginW),$("#loginBtn").removeAttr("disabled"),disableSpinner()})}function showVerify(){document.querySelector("#nav-verify-tab").style.display="block",$('#modal a[href="#nav-verify"]').tab("show")}function register(e){enableSpinner(),e.preventDefault(),$("#registerBtn").attr("disabled","disabled"),fetch("/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:document.querySelector("#name").value,email:document.querySelector("#regEmail").value,password:document.querySelector("#regPassword").value,password2:document.querySelector("#regPassword2").value,phone:document.querySelector("#regPhone").value,DoB:document.querySelector("#regBirthday").value,sex:document.querySelector("#regGender").value,address:document.querySelector("#regAddress").value,city:document.querySelector("#regCity").value,town:document.querySelector("#regTown").value,"g-recaptcha-response":grecaptcha.getResponse(registerW)})}).then(function(e){e.json().then(function(e){e.success_msg?(Swal.fire({icon:"info",title:"Thông báo",html:e.success_msg}),showVerify()):Swal.fire({icon:"error",title:"Oops...",html:e.message})})}).finally(function(){grecaptcha.reset(registerW),$("#registerBtn").removeAttr("disabled"),disableSpinner()})}function logout(e){enableSpinner(),e.preventDefault(),fetch("/logout").then(function(e){e.json().then(function(e){renderUsernameToggle(),fetch("".concat(e.curTab,"/checkAuth")).then(function(e){e.text().then(function(e){"notAuth"===e&&(popupModal(),forceLogin=!0)})})})}).finally(function(){disableSpinner()})}function showForgot(e){e.preventDefault(),document.querySelector("#nav-forgot-tab").style.display="block",$('#modal a[href="#nav-forgot"]').tab("show")}function showReset(){document.querySelector("#nav-reset-tab").style.display="block",$('#modal a[href="#nav-reset"]').tab("show")}function hideUnused(){document.querySelector("#nav-verify-tab").style.display="none",document.querySelector("#nav-forgot-tab").style.display="none",document.querySelector("#nav-reset-tab").style.display="none"}function forgot(e){enableSpinner(),e.preventDefault(),$("#forgotBtn").attr("disabled","disabled"),fetch("/forgot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:document.querySelector("#forgotEmail").value,"g-recaptcha-response":grecaptcha.getResponse(forgotW)})}).then(function(e){e.json().then(function(e){e.success_msg?(Swal.fire({icon:"info",title:"",html:e.success_msg}),showReset()):Swal.fire({icon:"error",title:"Oops...",html:e.message})})}).finally(function(){grecaptcha.reset(forgotW),$("#forgotBtn").removeAttr("disabled"),disableSpinner()})}function resetPasswordForm(e){enableSpinner(),e.preventDefault(),$("#resetBtn").attr("disabled","disabled");var t=document.querySelector("#resetToken").value;fetch("/forgot/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({"g-recaptcha-response":grecaptcha.getResponse(resetW)})}).then(function(e){e.json().then(function(e){e.message?(Swal.fire({icon:"error",title:"Oops...",html:e.message}),grecaptcha.reset(resetW),$("#resetBtn").removeAttr("disabled")):fetch("/reset/".concat(e.id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:document.querySelector("#resetPassword").value,password2:document.querySelector("#resetPassword2").value})}).then(function(e){e.json().then(function(e){e.success_msg?(Swal.fire({icon:"success",title:"Thành công",html:e.success_msg}),$('#modal a[href="#nav-sign-in"]').tab("show"),hideUnused()):Swal.fire({icon:"error",title:"Oops...",html:e.message})})})})}).finally(function(){grecaptcha.reset(resetW),$("#resetBtn").removeAttr("disabled"),disableSpinner()})}function verify(e){enableSpinner(),e.preventDefault(),$("#activateBtn").attr("disabled","disabled");var t=document.querySelector("#verifyToken").value;fetch("/activate/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({"g-recaptcha-response":grecaptcha.getResponse(activateW)})}).then(function(e){e.json().then(function(e){e.message?Swal.fire({icon:"error",title:"Oops...",html:e.message}):(Swal.fire({icon:"info",title:"",html:e.success_msg}),$('#modal a[href="#nav-sign-in"]').tab("show"),hideUnused())})}).finally(function(){grecaptcha.reset(activateW),$("#activateBtn").removeAttr("disabled"),disableSpinner()})}function forceLoginAndRedirect(e){redirectURL=e,fetch("/isLogin").then(function(t){t.text().then(function(t){"false"===t?popupModal():(enableSpinner(),window.location=e,disableSpinner())})})}function CaptchaCallback(){var e="6LcxngkaAAAAAO-aKP2yGehcIFJ8bIXHiJ6awbZB";loginW=grecaptcha.render("loginCaptcha",{sitekey:e}),registerW=grecaptcha.render("registerCaptcha",{sitekey:e}),activateW=grecaptcha.render("activateCaptcha",{sitekey:e}),forgotW=grecaptcha.render("forgotCaptcha",{sitekey:e}),resetW=grecaptcha.render("resetCaptcha",{sitekey:e})}